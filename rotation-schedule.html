<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a7ea4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Î°úÌÖåÏù¥ÏÖò ÏùºÏ†ï">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Î≥∏Í≥º 3ÌïôÎÖÑ Î°úÌÖåÏù¥ÏÖò ÏùºÏ†ï Í¥ÄÎ¶¨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --primary: #0a7ea4;
            --primary-dark: #065a75;
            --secondary: #34d399;
            --accent: #f59e0b;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: rgba(15, 23, 42, 0.08);
            --shadow-lg: rgba(15, 23, 42, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: var(--bg-card);
            padding: 30px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 30px;
            border-left: 6px solid var(--primary);
        }
        
        h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 400;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 30px;
            align-items: start;
        }
        
        .calendar-section {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow);
            position: sticky;
            top: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .calendar-header h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-day-header {
            text-align: center;
            padding: 10px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            background: var(--bg-main);
        }
        
        .calendar-day:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }
        
        .calendar-day.empty {
            background: transparent;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            transform: none;
        }
        
        .calendar-day.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(10, 126, 164, 0.3);
        }
        
        .calendar-day.has-schedule {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
            font-weight: 600;
        }
        
        .calendar-day.has-exam {
            position: relative;
        }
        
        .calendar-day.has-exam::after {
            content: "‚≠ê";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
        }
        
        .calendar-day[data-subject-color] {
            position: relative;
            font-weight: 600;
        }
        
        .calendar-day[data-subject-color]::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 0 0 10px 10px;
            background: attr(data-subject-color);
        }
        
        .exam-toggle {
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .exam-toggle:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }
        
        .exam-toggle.active {
            background: #fef3c7;
            border-color: #fbbf24;
        }
        
        .subject-manager {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .subject-manager h3 {
            font-size: 16px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 15px;
        }
        
        .subject-item {
            background: white;
            border: 2px solid #fbbf24;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .subject-color-picker {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 3px solid #e5e7eb;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }
        
        .subject-color-picker:hover {
            transform: scale(1.1);
            border-color: #9ca3af;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 12px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            margin-top: 8px;
            width: 100%;
        }
        
        .color-option {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .color-option:hover {
            transform: scale(1.15);
            border-color: #374151;
        }
        
        .color-option.selected {
            border-color: #374151;
            border-width: 3px;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #374151;
        }
        
        .subject-input, .date-input {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 13px;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .subject-input {
            flex: 1;
            min-width: 120px;
        }
        
        .date-input {
            width: 110px;
        }
        
        .remove-subject-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        
        .add-subject-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        
        .add-subject-btn:hover {
            background: #10b981;
        }
        
        .schedule-section {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow);
            min-height: 600px;
        }
        
        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .schedule-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .btn-export {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(10, 126, 164, 0.2);
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(10, 126, 164, 0.3);
        }
        
        .btn-export:active {
            transform: translateY(0);
        }
        
        .teams-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .team-schedule {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .team-schedule:hover {
            border-color: var(--primary);
            box-shadow: 0 8px 24px var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }
        
        .team-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .add-schedule-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-schedule-btn:hover {
            background: #10b981;
            transform: scale(1.05);
        }
        
        .schedule-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .time-input, .location-input {
            padding: 10px 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s ease;
            background: white;
        }
        
        .time-input {
            width: 100px;
            font-weight: 500;
        }
        
        .location-input {
            flex: 1;
        }
        
        .time-input:focus, .location-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 126, 164, 0.1);
        }
        
        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .remove-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }
        
        .notes-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid var(--accent);
            border-radius: 16px;
            padding: 20px;
        }
        
        .notes-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .notes-section h3::before {
            content: "üìå";
            font-size: 18px;
        }
        
        .notes-textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #fbbf24;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Noto Sans KR', sans-serif;
            resize: vertical;
            min-height: 100px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .notes-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 40px;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .empty-state p {
            font-size: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }
        
        .modal.show {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .modal-header h3 {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .close-modal:hover {
            background: var(--bg-main);
            color: var(--text-primary);
        }
        
        .export-message {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.8;
            white-space: pre-wrap;
            color: var(--text-primary);
            border: 2px solid var(--border);
        }
        
        .copy-btn {
            width: 100%;
            margin-top: 20px;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .copy-btn:hover {
            background: #10b981;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 211, 153, 0.3);
        }
        
        .copy-btn.copied {
            background: var(--primary);
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .calendar-section {
                position: relative;
                top: 0;
            }
            
            .teams-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè• Î≥∏Í≥º 3ÌïôÎÖÑ Î°úÌÖåÏù¥ÏÖò ÏùºÏ†ï Í¥ÄÎ¶¨</h1>
            <p class="subtitle">4Í∞ú Ï°∞ ÌÜµÌï© Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</p>
        </header>
        
        <div class="main-content">
            <div class="calendar-section">
                <div class="calendar-header">
                    <h2 id="calendarTitle">2026ÎÖÑ 3Ïõî</h2>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="changeMonth(-1)" style="background: var(--primary); color: white; border: none; width: 36px; height: 36px; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold;">‚Äπ</button>
                        <button onclick="changeMonth(1)" style="background: var(--primary); color: white; border: none; width: 36px; height: 36px; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold;">‚Ä∫</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendar">
                    <!-- Calendar will be generated by JavaScript -->
                </div>
                
                <div class="subject-manager" id="subjectManager" style="margin-top: 25px;">
                    <!-- Subject manager will be rendered here -->
                </div>
            </div>
            
            <div class="schedule-section">
                <div id="scheduleContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÖ</div>
                        <h3>ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h3>
                        <p>ÏôºÏ™Ω Îã¨Î†•ÏóêÏÑú ÏùºÏ†ïÏùÑ Í¥ÄÎ¶¨Ìï† ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì§ ÏùºÏ†ï ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h3>
                <button class="close-modal" onclick="closeModal()">√ó</button>
            </div>
            <div class="export-message" id="exportMessage"></div>
            <button class="copy-btn" onclick="copyToClipboard()">ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨</button>
        </div>
    </div>

    <script>
        // Data structure to store schedules
        let scheduleData = {};
        let selectedDate = null;
        let currentYear = 2026;
        let currentMonth = 3; // March (1-based)
        let subjects = []; // Array of {name, color, startDate, endDate}
        let examDates = new Set(); // Set of dates with exams
        let showingColorPicker = null; // Track which subject is showing color picker
        
        // Month data for 2026
        const monthData = {
            3: { name: '3Ïõî', firstDay: 6, days: 31 },
            4: { name: '4Ïõî', firstDay: 2, days: 30 },
            5: { name: '5Ïõî', firstDay: 4, days: 31 },
            6: { name: '6Ïõî', firstDay: 0, days: 30 },
            7: { name: '7Ïõî', firstDay: 2, days: 31 },
            8: { name: '8Ïõî', firstDay: 5, days: 31 },
            9: { name: '9Ïõî', firstDay: 1, days: 30 },
            10: { name: '10Ïõî', firstDay: 3, days: 31 },
            11: { name: '11Ïõî', firstDay: 6, days: 30 },
            12: { name: '12Ïõî', firstDay: 1, days: 31 }
        };
        
        // 20 color palette
        const colorPalette = [
            '#ef4444', // Îπ®Í∞ï
            '#f97316', // Ï£ºÌô©
            '#f59e0b', // ÎÖ∏Îûë-Ï£ºÌô©
            '#eab308', // ÎÖ∏Îûë
            '#84cc16', // Ïó∞Îëê
            '#22c55e', // Ï¥àÎ°ù
            '#10b981', // Ï≤≠Î°ù
            '#14b8a6', // ÌÑ∞ÏΩ∞Ïù¥Ï¶à
            '#06b6d4', // ÌïòÎäò
            '#0ea5e9', // ÌååÎûë
            '#3b82f6', // ÏßÑÌååÎûë
            '#6366f1', // Ïù∏ÎîîÍ≥†
            '#8b5cf6', // Î≥¥Îùº
            '#a855f7', // ÏûêÏ£º
            '#d946ef', // ÎßàÏ††ÌÉÄ
            '#ec4899', // ÌïëÌÅ¨
            '#f43f5e', // Î°úÏ¶à
            '#64748b', // ÌöåÏÉâ
            '#78716c', // Í∞àÏÉâ
            '#57534e'  // ÏßÑÍ∞àÏÉâ
        ];
        
        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('rotationScheduleData');
            if (saved) {
                try {
                    scheduleData = JSON.parse(saved);
                } catch (e) {
                    scheduleData = {};
                }
            }
            
            const savedSubjects = localStorage.getItem('rotationSubjects');
            if (savedSubjects) {
                try {
                    subjects = JSON.parse(savedSubjects);
                } catch (e) {
                    subjects = [];
                }
            }
            
            const savedExams = localStorage.getItem('rotationExams');
            if (savedExams) {
                try {
                    examDates = new Set(JSON.parse(savedExams));
                } catch (e) {
                    examDates = new Set();
                }
            }
        }
        
        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('rotationScheduleData', JSON.stringify(scheduleData));
                localStorage.setItem('rotationSubjects', JSON.stringify(subjects));
                localStorage.setItem('rotationExams', JSON.stringify([...examDates]));
            } catch (e) {
                console.error('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïã§Ìå®:', e);
            }
        }
        
        // Get subject for a specific date
        function getSubjectForDate(dateStr) {
            for (let subject of subjects) {
                if (dateStr >= subject.startDate && dateStr <= subject.endDate) {
                    return subject;
                }
            }
            return null;
        }
        
        // Initialize calendar
        function initCalendar() {
            const calendar = document.getElementById('calendar');
            const daysOfWeek = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            
            calendar.innerHTML = '';
            
            daysOfWeek.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            const monthInfo = monthData[currentMonth];
            const firstDay = monthInfo.firstDay;
            const daysInMonth = monthInfo.days;
            
            document.getElementById('calendarTitle').textContent = `2026ÎÖÑ ${monthInfo.name}`;
            
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendar.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                dayCell.textContent = day;
                const dateStr = `2026-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                dayCell.dataset.date = dateStr;
                
                // Add subject color
                const subject = getSubjectForDate(dateStr);
                if (subject) {
                    dayCell.style.setProperty('--subject-color', subject.color);
                    dayCell.setAttribute('data-subject-color', subject.color);
                }
                
                // Add exam marker
                if (examDates.has(dateStr)) {
                    dayCell.classList.add('has-exam');
                }
                
                dayCell.onclick = () => selectDate(dateStr);
                calendar.appendChild(dayCell);
            }
            
            // Apply subject color via style element
            const style = document.createElement('style');
            style.textContent = subjects.map((subject, index) => 
                `.calendar-day[data-subject-color="${subject.color}"]::before { background: ${subject.color}; }`
            ).join('\n');
            
            const oldStyle = document.getElementById('dynamic-subject-styles');
            if (oldStyle) oldStyle.remove();
            style.id = 'dynamic-subject-styles';
            document.head.appendChild(style);
            
            updateCalendarIndicators();
        }
        
        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 3) currentMonth = 3;
            if (currentMonth > 12) currentMonth = 12;
            selectedDate = null;
            initCalendar();
            document.getElementById('scheduleContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìÖ</div>
                    <h3>ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h3>
                    <p>ÏôºÏ™Ω Îã¨Î†•ÏóêÏÑú ÏùºÏ†ïÏùÑ Í¥ÄÎ¶¨Ìï† ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                </div>
            `;
        }
        
        function toggleExam() {
            if (!selectedDate) return;
            if (examDates.has(selectedDate)) {
                examDates.delete(selectedDate);
            } else {
                examDates.add(selectedDate);
            }
            saveData();
            initCalendar();
            renderSchedule();
        }
        
        function selectDate(date) {
            selectedDate = date;
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
                if (day.dataset.date === date) {
                    day.classList.add('selected');
                }
            });
            
            if (!scheduleData[date]) {
                scheduleData[date] = {
                    teams: ['1Ï°∞'],
                    teamSchedules: { '1Ï°∞': [] },
                    notes: ''
                };
                saveData();
            }
            renderSchedule();
        }
        
        function addTeam() {
            if (!selectedDate) return;
            const data = scheduleData[selectedDate];
            const teamCount = data.teams.length;
            const newTeamName = `${teamCount + 1}Ï°∞`;
            data.teams.push(newTeamName);
            data.teamSchedules[newTeamName] = [];
            saveData();
            renderSchedule();
        }
        
        function removeTeam(teamName) {
            if (!selectedDate) return;
            const data = scheduleData[selectedDate];
            if (data.teams.length <= 1) {
                alert('ÏµúÏÜå 1Í∞úÏùò Ï°∞Îäî ÏûàÏñ¥Ïïº Ìï©ÎãàÎã§!');
                return;
            }
            data.teams = data.teams.filter(t => t !== teamName);
            delete data.teamSchedules[teamName];
            saveData();
            renderSchedule();
        }
        
        function renderSchedule() {
            if (!selectedDate) return;
            const data = scheduleData[selectedDate];
            const dateObj = new Date(selectedDate);
            const dateStr = `${dateObj.getMonth() + 1}Ïõî ${dateObj.getDate()}Ïùº`;
            const isExam = examDates.has(selectedDate);
            
            const content = `
                <div class="schedule-header">
                    <h2>${dateStr} ÏùºÏ†ï</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button class="exam-toggle ${isExam ? 'active' : ''}" onclick="toggleExam()">
                            ${isExam ? '‚≠ê' : '‚òÜ'} ÏãúÌóò
                        </button>
                        <button class="add-schedule-btn" onclick="addTeam()" style="padding: 10px 20px;">‚ûï Ï°∞ Ï∂îÍ∞Ä</button>
                        <button class="btn-export" onclick="exportSchedule()">üì§ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                    </div>
                </div>
                
                <div class="teams-container">
                    ${data.teams.map(team => `
                        <div class="team-schedule">
                            <div class="team-header">
                                <span class="team-name">${team}</span>
                                <div style="display: flex; gap: 6px;">
                                    <button class="add-schedule-btn" onclick="addScheduleItem('${team}')">+ Ï∂îÍ∞Ä</button>
                                    ${data.teams.length > 1 ? `<button class="remove-btn" onclick="removeTeam('${team}')" style="padding: 6px 12px;">üóëÔ∏è Ï°∞ ÏÇ≠Ï†ú</button>` : ''}
                                </div>
                            </div>
                            <div id="team-${team}">${renderTeamSchedules(team)}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="notes-section">
                    <h3>Ï∞∏Í≥†ÏÇ¨Ìï≠</h3>
                    <textarea class="notes-textarea" placeholder="Ï∂îÍ∞ÄÎ°ú Í≥µÏßÄÌï† ÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." onchange="updateNotes(this.value)">${data.notes}</textarea>
                </div>
            `;
            
            document.getElementById('scheduleContent').innerHTML = content;
            updateCalendarIndicators();
        }
        
        function renderTeamSchedules(team) {
            const schedules = scheduleData[selectedDate].teamSchedules[team];
            if (schedules.length === 0) {
                return '<p style="color: var(--text-secondary); font-size: 14px; padding: 10px 0;">ÏùºÏ†ïÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî</p>';
            }
            return schedules.map((item, index) => `
                <div class="schedule-item">
                    <input type="text" class="time-input" placeholder="09:00" value="${item.time}" onchange="updateScheduleItem('${team}', ${index}, 'time', this.value)" />
                    <input type="text" class="location-input" placeholder="Ïã§Ïäµ Ïû•ÏÜå ÏûÖÎ†•" value="${item.location}" onchange="updateScheduleItem('${team}', ${index}, 'location', this.value)" />
                    <button class="remove-btn" onclick="removeScheduleItem('${team}', ${index})">ÏÇ≠Ï†ú</button>
                </div>
            `).join('');
        }
        
        function addScheduleItem(team) {
            scheduleData[selectedDate].teamSchedules[team].push({ time: '', location: '' });
            saveData();
            renderSchedule();
        }
        
        function removeScheduleItem(team, index) {
            scheduleData[selectedDate].teamSchedules[team].splice(index, 1);
            saveData();
            renderSchedule();
        }
        
        function updateScheduleItem(team, index, field, value) {
            scheduleData[selectedDate].teamSchedules[team][index][field] = value;
            saveData();
            updateCalendarIndicators();
        }
        
        function updateNotes(value) {
            scheduleData[selectedDate].notes = value;
            saveData();
        }
        
        function updateCalendarIndicators() {
            document.querySelectorAll('.calendar-day').forEach(day => {
                if (day.dataset.date && scheduleData[day.dataset.date]) {
                    const data = scheduleData[day.dataset.date];
                    const hasSchedules = data.teams.some(team => 
                        data.teamSchedules[team] && data.teamSchedules[team].length > 0
                    );
                    if (hasSchedules) {
                        day.classList.add('has-schedule');
                    } else {
                        day.classList.remove('has-schedule');
                    }
                }
            });
        }
        
        function addSubject() {
            subjects.push({ name: '', color: colorPalette[0], startDate: '', endDate: '' });
            saveData();
            renderSubjectManager();
        }
        
        function removeSubject(index) {
            subjects.splice(index, 1);
            saveData();
            initCalendar();
            renderSubjectManager();
        }
        
        function updateSubject(index, field, value) {
            subjects[index][field] = value;
            saveData();
            if (field === 'color' || field === 'startDate' || field === 'endDate') {
                initCalendar();
            }
            renderSubjectManager();
        }
        
        function toggleColorPicker(index) {
            showingColorPicker = showingColorPicker === index ? null : index;
            renderSubjectManager();
        }
        
        function renderSubjectManager() {
            const container = document.getElementById('subjectManager');
            
            let html = `<h3>üìö Í≥º Îã®ÏúÑ Í∏∞Í∞Ñ ÏÑ§Ï†ï</h3>`;
            
            subjects.forEach((subject, index) => {
                html += `
                    <div class="subject-item">
                        <div class="subject-color-picker" style="background: ${subject.color};" onclick="toggleColorPicker(${index})"></div>
                        <input type="text" class="subject-input" placeholder="Í≥º Ïù¥Î¶Ñ ÏûÖÎ†• (Ïòà: ÏÇ∞Î∂ÄÏù∏Í≥º)" value="${subject.name}" onchange="updateSubject(${index}, 'name', this.value)" />
                        <input type="date" class="date-input" value="${subject.startDate}" onchange="updateSubject(${index}, 'startDate', this.value)" min="2026-03-01" max="2026-12-31" />
                        <span>~</span>
                        <input type="date" class="date-input" value="${subject.endDate}" onchange="updateSubject(${index}, 'endDate', this.value)" min="2026-03-01" max="2026-12-31" />
                        <button class="remove-subject-btn" onclick="removeSubject(${index})">ÏÇ≠Ï†ú</button>
                `;
                
                if (showingColorPicker === index) {
                    html += `
                        <div class="color-palette">
                            ${colorPalette.map(color => `
                                <div class="color-option ${subject.color === color ? 'selected' : ''}" 
                                     style="background: ${color};" 
                                     onclick="updateSubject(${index}, 'color', '${color}'); toggleColorPicker(${index});"></div>
                            `).join('')}
                        </div>
                    `;
                }
                
                html += `</div>`;
            });
            
            html += `<button class="add-subject-btn" onclick="addSubject()">+ Í≥º Ï∂îÍ∞Ä</button>`;
            container.innerHTML = html;
        }
        
        function exportSchedule() {
            if (!selectedDate) return;
            const data = scheduleData[selectedDate];
            const dateObj = new Date(selectedDate);
            const dateStr = `${dateObj.getMonth() + 1}Ïõî ${dateObj.getDate()}Ïùº`;
            const dayOfWeek = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'][dateObj.getDay()];
            const subject = getSubjectForDate(selectedDate);
            const isExam = examDates.has(selectedDate);
            
            let message = `üìÖ ${dateStr}(${dayOfWeek}) Î°úÌÖåÏù¥ÏÖò ÏùºÏ†ï\n`;
            if (subject) message += `üìö ${subject.name}\n`;
            if (isExam) message += `‚≠ê ÏãúÌóòÏùº\n`;
            message += `${'='.repeat(40)}\n\n`;
            
            data.teams.forEach(team => {
                const schedules = data.teamSchedules[team];
                if (schedules && schedules.length > 0) {
                    message += `„Äê ${team} „Äë\n`;
                    schedules.forEach(item => {
                        if (item.time && item.location) {
                            message += `  ${item.time}  ‚Üí  ${item.location}\n`;
                        }
                    });
                    message += `\n`;
                }
            });
            
            if (data.notes.trim()) {
                message += `üìå Ï∞∏Í≥†ÏÇ¨Ìï≠\n${'-'.repeat(40)}\n${data.notes}\n`;
            }
            
            message += `\n${'='.repeat(40)}`;
            document.getElementById('exportMessage').textContent = message;
            document.getElementById('exportModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('exportModal').classList.remove('show');
        }
        
        function copyToClipboard() {
            const message = document.getElementById('exportMessage').textContent;
            navigator.clipboard.writeText(message).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = '‚úì Î≥µÏÇ¨ ÏôÑÎ£å!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            });
        }
        
        document.getElementById('exportModal').addEventListener('click', (e) => {
            if (e.target.id === 'exportModal') closeModal();
        });
        
        // Îç∞Ïù¥ÌÑ∞ Î≤ÑÏ†Ñ Ï≤¥ÌÅ¨ Î∞è ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò
        const DATA_VERSION = '2.0';
        const savedVersion = localStorage.getItem('rotationDataVersion');
        
        if (savedVersion !== DATA_VERSION) {
            console.log('Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Î≥ÄÍ≤Ω Í∞êÏßÄ - Ï¥àÍ∏∞Ìôî Ï§ë...');
            localStorage.removeItem('rotationScheduleData');
            localStorage.removeItem('rotationSubjects');
            localStorage.removeItem('rotationExams');
            localStorage.setItem('rotationDataVersion', DATA_VERSION);
            alert('Ïï±Ïù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§!\nÍ∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ÏôÄ Ìò∏ÌôòÎêòÏßÄ ÏïäÏïÑ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
        }
        
        loadData();
        initCalendar();
        renderSubjectManager();
        
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
